
// Generated by MyGeneration Version # (1.3.0.3)

using System;

using System.Data;
namespace BusinessLayer
{
    public class tblOrder : _tblOrder
    {
        public tblOrder()
        {

        }
        public DataTable LoadGridData(string strColumnName, string strColumnValue)
        {
            strColumnValue = strColumnValue.Replace("'", "");

            string StrQuery = " Select tblOrder.*,tblCustomer.appFirstName + ' '+ tblCustomer.appLastName as AppCustomerName,tblOrderStatus.appOrderStatus 	 From tblOrder	Inner Join tblCustomer On tblCustomer.appCustomerID=tblOrder.appCustomerID	Inner Join tblOrderStatus On tblOrderStatus.appOrderStatusID=tblOrder.appOrderStatusID where 1=1 ";

            if (!string.IsNullOrEmpty(strColumnValue) & strColumnName != "0")
            {
                StrQuery += " and " + strColumnName + " LIKE '%" + strColumnValue + "%'";
            }
            else if (strColumnName == "0" && string.IsNullOrEmpty(strColumnValue))
            {
                StrQuery += " and ( appReceiverName LIKE '%" + strColumnValue + "%'";
                StrQuery += " or  appReceiverContactNo1 LIKE '%" + strColumnValue + "%' ";
                //StrQuery += " or  appReceiverContactNo2 LIKE '%" + strColumnValue + "%' ";
                StrQuery += " or  appRecevierEmail LIKE '%" + strColumnValue + "%' ";
                //StrQuery += " or  appPreferedTime LIKE '%" + strColumnValue + "%' ";

                StrQuery += " or  appBillReceiverName LIKE '%" + strColumnValue + "%' )";
                //StrQuery += " or  appBillReceiverContactNo1 LIKE '%" + strColumnValue + "%' ";
                //StrQuery += " or  appBillReceiverContactNo2 LIKE '%" + strColumnValue + "%' ";
                //StrQuery += " or  appBillRecevierEmail LIKE '%" + strColumnValue + "%' )";

            }

            StrQuery += " order by appOrderID Desc  ";
            base.LoadFromRawSql(StrQuery);
            return base.DefaultView.Table;
        }
   
        public DataTable GetOrderList(string strColumnName, string strColumnValue, string strStatus, string strCourierCompanyId = "", string strMenifest = "", string strCompleteDate = "", string returnStatusId = "", string stFromDate = "", string strToDate = "")
        {
            int flag = 0, flagOrder = 0, flagTotalAmount = 0;
            if (strColumnName == "appCustomerName")
            {
                flag = 1;
            }
            if (strColumnName == "appOrderNo")
            {
                flagOrder = 1;
            }
            if (strColumnName == "tblTemp.appAmount")
            {
                flagTotalAmount = 1;
            }
            strColumnValue = strColumnValue.Replace("'", "");
            String StrQuery = "  Select convert(varchar,tblSubOrder.appSubOrderChangeDate,105) appSubOrderChangeDate,convert(varchar,tblSubOrder.appMaxDispatchDate,105) appMaxDispatchDate, convert(varchar,tblOrder.appCreatedDate,103) as appOrderedDate,(tblCustomer.appFirstName+' '+tblCustomer.appLastName)appCustomerName,tblProductDetail.appProductDetailID,tblProductDetail.appProductColorID,tblProductDetail.appSKUNo,tblProductDetail.appSizeID, tblProduct.appProductId,tblProduct.appProductName,tblProduct.appProductCode, tblProduct.appWeight,  tblOrder.appOrderID,tblOrder.appOrderNo,tblOrder.appCustomerID,convert(varchar(10),tblOrder.appCreatedDate,103) appCreatedDate,tblOrder.appOrderAmount,convert(varchar(10),tblOrder.appOrderStatusChangeDate,103) appOrderStatusChangeDate,tblOrder.appReceiverName,tblOrder.appReceiverAddress,tblOrder.appReceiverContactNo1,tblOrder.appReceiverContactNo2,tblOrder.appPreferedTime,tblOrder.appRecevierEmail,tblOrder.appPaymentMode,tblOrder.appBillReceiverPIN,tblOrder.appReceiverPIN,tblSubOrder.appSubOrderID,tblSubOrder.appSubOrderNo,tblSubOrder.appSubOrderStatusID,tblSubOrder.appProductDetailID,tblSubOrder.appQty,tblSubOrder.appCurrencyID,tblSubOrder.appRate,tblSubOrder.appSellingPrice,tblSubOrder.appDiscount,tblSubOrder.appCourierCompanyID,tblSubOrder.appDocketNo,tblsubOrder.appInvoiceURL,convert(varchar(10),tblSubOrder.appMaxDispatchDate,103)appMaxDispatchDate,convert(varchar(10),tblSubOrder.appShippedDate,103)appShippedDate,tblSubOrder.appShippedStatus,tblSubOrder.appIsPaid,tblSubOrder.appManifestGenerated,tblSubOrder.appManifestID,tblSubOrder.appSelfCourier,tblSubOrder.appInvoiceGenerated,tblSubOrder.appShippingCharges,tblSubOrder.appDispatchDate,tblSubOrder.appDeliveryDate,tblSubOrder.appCODCharges,tblOrderStatus.appOrderStatus,tblCourierCompany.appCourierCompany,tblCourierCompany.appCourierCompanyID , DATEDIFF(day,getDate(),appMaxDispatchDate) appRemmingDispatchDay,tblReturnOrderDetail.appReturnOrderID,tblReturnOrder.appReturnStatus,(IsNull(tblSubOrder.appQty,0)*IsNull(tblSubOrder.appDiscount,0)) as appTotalDiscount,  (IsNull(tblSubOrder.appQty,0)*IsNull(tblSubOrder.appSellingPrice,0)) - (IsNull(tblSubOrder.appQty,0)*IsNull(tblSubOrder.appDiscount,0)) as appTotalamountToBePaid  , tblTemp.appAmount";
            StrQuery += " from  tblOrder";
            StrQuery += " Inner join ( select tblSubOrder.appOrderID ,min(tblSubOrder.appSubOrderID) as appSubOrderID,sum((tblSubOrder.appQty*tblSubOrder.appSellingPrice)-((tblSubOrder.appQty*tblSubOrder.appDiscount))) as appAmount from tblSubOrder Inner join tblOrder on tblOrder.appOrderID=tblSubOrder.appOrderID Inner join tblProductDetail on tblProductDetail.appProductDetailID=tblSubOrder.appProductDetailID   Inner join tblProductColor On tblProductColor.appProductColorID=tblProductDetail.appProductColorID  			Inner join tblProduct on tblProduct.appProductID=tblProductColor.appProductID   ";
            if (strStatus != "")
            {
                StrQuery += " where appSubOrderStatusID  in (" + strStatus + ") ";
            }
            if (!string.IsNullOrEmpty(strColumnValue) & strColumnName != "0")
            {
                if (flag == 0 && flagOrder == 0 && flagTotalAmount == 0)
                {
                    StrQuery += " and " + strColumnName + " LIKE '%" + strColumnValue + "%'";
                }
                if (flag == 0 && flagOrder == 1 && flagTotalAmount == 0)
                {
                    StrQuery += " and " + strColumnName + " LIKE '" + strColumnValue + "'";
                }
                //else if (flag == 1 && flagOrder == 0 && flagTotalAmount == 0)
                //{
                //    StrQuery += " and appCustomerName LIKE '%" + strColumnValue + "%')";
                //}
            }
            else if (strColumnName == "0" && !(string.IsNullOrEmpty(strColumnValue)) && flagTotalAmount == 0)
            {
                StrQuery += " and ( appProductName LIKE '%" + strColumnValue + "%'";
                StrQuery += " or  appQty LIKE '%" + strColumnValue + "%' ";
                //   StrQuery += " or  appSellingPrice LIKE '%" + strColumnValue + "%' ";
                StrQuery += " or  appSKUNo LIKE '%" + strColumnValue + "%' ";
                //StrQuery += " or  appLastName LIKE '%" + strColumnValue + "%' ";
                //StrQuery += " or  appFirstName LIKE '%" + strColumnValue + "%' )";
            }
            StrQuery += "  group by tblSubOrder.appOrderID	)tblTemp   on tblTemp.appOrderID=tblOrder.appOrderID";
            if (flagTotalAmount == 1)
            {
                StrQuery += " and  " + strColumnName + "='" + strColumnValue + "'";
            }
            StrQuery += " inner join  tblSubOrder on tblSubOrder.appSubOrderID=tblTemp.appSubOrderID ";
            StrQuery += " inner join tblOrderStatus  on tblOrderStatus.appOrderStatusID=tblSubOrder.appSubOrderStatusID";
            StrQuery += " Inner join tblProductDetail on tblProductDetail.appProductDetailID=tblSubOrder.appProductDetailID  ";
            StrQuery += " Inner join tblProductColor On tblProductColor.appProductColorID=tblProductDetail.appProductColorID ";
            StrQuery += " Inner join tblProduct on tblProduct.appProductID=tblProductColor.appProductID  ";
            StrQuery += " inner join tblCustomer on tblCustomer.appCustomerID=tblOrder.appCustomerID ";
            StrQuery += " Left Join (Select appsubOrderId, max(appReturnOrderID) appReturnOrderID	From tblReturnOrderDetail	Group by appsubOrderId)tblReturnOrderDetail on tblReturnOrderDetail.appSubOrderID=tblSubOrder.appSubOrderID     ";
            StrQuery += " Left Join tblReturnOrder on tblReturnOrder.appReturnOrderID=tblReturnOrderDetail.appReturnOrderID   ";
            StrQuery += " Left Join tblCourierCompany on tblCourierCompany.appCourierCompanyID=tblSubOrder.appCourierCompanyID where 1=1 ";


            if (strCourierCompanyId != "0" && strCourierCompanyId != "")
            {
                StrQuery += " and tblCourierCompany.appCourierCompanyID='" + strCourierCompanyId + "'";
            }
            if (strMenifest != "0" && strMenifest != "")
            {
                if (strMenifest == "true")
                {
                    StrQuery += " and tblSubOrder.appManifestGenerated=1 ";
                }
                else if (strMenifest == "false")
                {
                    StrQuery += " and tblSubOrder.appManifestGenerated=0 ";
                }
            }
            if (returnStatusId != "")
            {
                StrQuery += " and tblReturnOrder.appReturnStatus='" + returnStatusId + "' ";
            }
            if (stFromDate != "" && strToDate != "")
            {
                StrQuery += " and convert(DateTime,convert(varchar(10),tblOrder.appCreatedDate,103),103) between convert(DateTime,convert(varchar(10),'" + stFromDate + "',103),103) and convert(DateTime,convert(varchar(10),'" + strToDate + "',103),103)";
            }
            if (flag == 1 && flagOrder == 0 && flagTotalAmount == 0)
            {

                StrQuery += " and (tblCustomer.appFirstName+' '+tblCustomer.appLastName)  LIKE '%" + strColumnValue + "%'";
            }
            StrQuery += " order by tblOrder.appOrderID  Desc";
            base.LoadFromRawSql(StrQuery);
            return base.DefaultView.Table;
        }
        
        public DataTable LoadReturnData(string strColumnName, string strColumnValue, string strStatus, string returnStatusId = "")
        {
            int flag = 0, flagOrder = 0;
            strColumnValue = strColumnValue.Replace("'", "");
            string StrQuery = " Select   tblSubOrder.appSubOrderChangeDate,tblOrderStatus.appOrderStatus,  tblReturnOrder.appReturnOrderID,tblReturnOrderDetail.appReturnOrderDetailID,tblReturnOrderDetail.appSubOrderID,tblReturnOrder.appReason,tblReturnOrder.appNote,tblReturnOrder.appRequestedDate,tblReturnOrder.appReturnStatus,tblReturnOrder.appCourierCompanyID,tblReturnOrder.appDocketNo,tblReturnOrder.appPickupName,tblReturnOrder.appPickupAddress,tblReturnOrder.appPickupContactNo1,tblReturnOrder.appPickupContactNo2,tblReturnOrder.appPickupPIN,tblReturnOrder.appPreferedTime,tblReturnOrder.appDropName,tblReturnOrder.appDropAddress,tblReturnOrder.appDropContactNo1,tblReturnOrder.appDropContactNo2,tblReturnOrder.appDropPIN,tblReturnOrder.appPreviousSubOrderStatus,tblReturnOrder.appCourierCompanyContactNo,tblReturnOrder.appCourierCompanyWebsite, tblSubOrder.appSubOrderID,tblSubOrder.appOrderID,tblSubOrder.appSubOrderNo,tblSubOrder.appProductDetailID,tblSubOrder.appQty,tblSubOrder.appSellingPrice,tblSubOrder.appSubOrderStatusID,convert(varchar,tblSubOrder.appSubOrderChangeDate,105) appSubOrderChangeDate,convert(varchar,tblSubOrder.appMaxDispatchDate,105) appMaxDispatchDate,tblSubOrder.appIsPaid,	(IsNull(tblSubOrder.appQty,0)*IsNull(tblSubOrder.appSellingPrice,0)) as appTotal, tblOrder.appOrderNo,tblOrder.appCustomerID,tblOrder.appPaymentMode  , tblProductDetail.appProductDetailID,tblProductDetail.appProductColorID,tblProductDetail.appSKUNo,tblProductDetail.appSizeID, tblProduct.appProductId,tblProduct.appProductName,tblProduct.appProductCode, tblProduct.appWeight,tblCourierCompany.appCourierCompany,tblCourierCompany.appCourierCompanyID  ";
            StrQuery += " From tblReturnOrder	  ";
            StrQuery += " inner join tblReturnOrderDetail on tblReturnOrderDetail.appReturnOrderID=tblReturnOrder.appReturnOrderID  ";
            StrQuery += " inner join tblSubOrder on tblSubOrder.appSubOrderID =tblReturnOrderDetail.appSubOrderID    ";
            StrQuery += " Inner join tblOrder on tblOrder.appOrderID=tblSubOrder.appOrderID  ";
            StrQuery += "  Inner join tblProductDetail on tblProductDetail.appProductDetailID=tblSubOrder.appProductDetailID    ";
            StrQuery += "  Inner join tblProductColor On tblProductColor.appProductColorID=tblProductDetail.appProductColorID    ";
            StrQuery += " Inner join tblProduct on tblProduct.appProductID=tblProductColor.appProductID     ";
            StrQuery += " inner join tblOrderStatus on tblSubOrder.appSubOrderStatusID=tblOrderStatus.appOrderStatusID    ";
            StrQuery += " Left Join tblCourierCompany on tblCourierCompany.appCourierCompanyID=tblSubOrder.appCourierCompanyID  where  1=1    ";
            if (strStatus != "")
            {
                StrQuery += " and tblSubOrder.appSubOrderStatusID in (" + strStatus + " )";
            }
            if (strColumnName == "appCustomerName")
            {
                flag = 1;
            }
            if (strColumnName == "appOrderNo")
            {
                flagOrder = 1;
            }
            if (!string.IsNullOrEmpty(strColumnValue) & strColumnName != "0")
            {
                if (flag == 0 && flagOrder == 0)
                {
                    StrQuery += " and " + strColumnName + " LIKE '%" + strColumnValue + "%'";
                }
                if (flag == 0 && flagOrder == 1)
                {
                    StrQuery += " and " + strColumnName + " LIKE '" + strColumnValue + "'";
                }
                else if (flag == 1 && flagOrder == 0)
                {
                    StrQuery += " and (appFirstName LIKE '%" + strColumnValue + "%' or appLastName LIKE '%" + strColumnValue + "%')";
                }
            }
            else if (strColumnName == "0" && !(string.IsNullOrEmpty(strColumnValue)))
            {
                StrQuery += " and ( appProductName LIKE '%" + strColumnValue + "%'";
                StrQuery += " or  appQty LIKE '%" + strColumnValue + "%' ";
                StrQuery += " or  appSellingPrice LIKE '%" + strColumnValue + "%' ";
                StrQuery += " or  appSKUNo LIKE '%" + strColumnValue + "%' ";
                //StrQuery += " or  appLastName LIKE '%" + strColumnValue + "%' ";
                //StrQuery += " or  appFirstName LIKE '%" + strColumnValue + "%' )";
            }








            if (returnStatusId != "")
            {
                StrQuery += " and tblReturnOrder.appReturnStatus='" + returnStatusId + "' ";
            }

            StrQuery += " order by tblSubOrder.appSubOrderID  Desc";
            base.LoadFromRawSql(StrQuery);
            return base.DefaultView.Table;
        }
        
        public DataTable LoadMyOrderList(string strCustomerID, string strOrderNo = "", string strOrderID = "")
        {
            string StrQuery = "select tblOrder.appOrderID,tblOrder.appOrderNo,tblOrder.appCustomerID,tblOrder.appCreatedDate,tblOrder.appOrderStatusID,tblOrder.appOrderAmount,tblOrder.appOrderStatusChangeDate,tblOrder.appReceiverName,tblOrder.appReceiverAddress,tblOrder.appReceiverContactNo1,tblOrder.appReceiverContactNo2,tblOrder.appPreferedTime,tblOrder.appRecevierEmail,tblOrder.appBillReceiverName,tblOrder.appBillReceiverAddress,tblOrder.appBillReceiverContactNo1,tblOrder.appBillReceiverContactNo2,tblOrder.appBillRecevierEmail,tblOrder.appReceiverPIN,tblOrder.appBillReceiverPIN,tblOrder.appPaymentMode from tblOrder ";
            StrQuery += "where  tblOrder.appCustomerID=" + strCustomerID + "  ";
            if (strOrderNo != "")
            {
                StrQuery += " and tblOrder.appOrderNo='" + strOrderNo + "' ";
            }
            if (strOrderID != "")
            {
                StrQuery += " and tblOrder.appOrderID='" + strOrderID + "' ";
            }
            StrQuery += "order by tblOrder.appOrderID  Desc ";
            base.LoadFromRawSql(StrQuery);
            return base.DefaultView.Table;
        }

        public DataTable GetOrderInfo(string strOrderId, string strStatus, string strPaymentMode = "")
        {
            String StrQuery = "  Select tblProduct.appProductName,tblProductImage.appSmallImage,tblProductDetail.appSKUNo,tblSubOrder.appQty,tblSubOrder.appSellingPrice as appRealPrice,tblSubOrder.appDiscount as appDiscountPrice,(tblSubOrder.appQty*tblSubOrder.appSellingPrice) as appTotalPrice,(tblSubOrder.appQty*tblSubOrder.appDiscount) asappDiscountPrice,tblOrder.appOrderNo,tblOrder.appOrderStatusID,tblOrder.appCreatedDate,tblOrder.appOrderAmount,tblOrder.appOrderStatusID,tblOrder.appReceiverName,tblOrder.appReceiverAddress,tblOrder.appReceiverContactNo1,tblOrder.appRecevierEmail,tblOrder.appReceiverPIN,tblOrder.appPaymentMode,tblCountry.appCountry,tblState.appState,tblCity.appCity ";
            StrQuery += " From tblSubOrder";
            StrQuery += " Inner join tblOrder on tblOrder.appOrderID=tblSubOrder.appOrderID ";
            StrQuery += " Inner join tblProductDetail on tblProductDetail.appProductDetailID=tblSubOrder.appProductDetailID  ";
            StrQuery += " Inner join tblProductColor On tblProductColor.appProductColorID=tblProductDetail.appProductColorID ";
            StrQuery += " Inner join tblProduct on tblProduct.appProductID=tblProductColor.appProductID  ";
            StrQuery += " Inner join tblProductImage On tblProductImage.appProductColorID=tblProductColor.appProductColorID and tblProductImage.appIsDefault=1 ";
            StrQuery += " Inner join tblCountry on tblCountry.appCountryID=tblOrder.appReceiverCountryID ";
            StrQuery += " Inner join tblState on tblState.appStateID=tblOrder.appReceiverStateID ";
            StrQuery += " Inner join tblCity on tblCity.appCityid=tblOrder.appReceiverCityID Where 1=1 ";

            if (strOrderId != "")
            {
                StrQuery += " and tblSubOrder.apporderId  in (" + strOrderId + ") ";
            }
            if (strStatus != "")
            {
                StrQuery += " and tblOrder.appOrderStatusID =" + strStatus;
            }
            if (strPaymentMode != "")
            {
                StrQuery += " and tblOrder.appPaymentMode=" + strPaymentMode;
            }
            StrQuery += " order by tblSubOrder.appSubOrderID ";
            base.LoadFromRawSql(StrQuery);
            return base.DefaultView.Table;
        }
       
        public DataTable GetShippedOrderInfo(string strOrderId, string strStatus)
        {
            String StrQuery = "  Select tblOrder.appOrderNo,tblOrder.appCreatedDate,tblOrder.appOrderAmount,tblOrder.appReceiverName,tblOrder.appReceiverAddress,tblOrder.appReceiverContactNo1,tblOrder.appRecevierEmail,tblOrder.appBillReceiverName,tblOrder.appBillReceiverAddress,tblOrder.appBillReceiverContactNo1,tblOrder.appBillRecevierEmail,tblOrder.appBillReceiverPIN,tblOrder.appReceiverPIN,tblOrder.AppPaymentMode,tblCourierCompany.appCourierCompany,tblSubOrder.appDocketNo,tblCountry.appCountry ,tblState.appState,tblCity.appCity,tblBillCountry.appCountry as appBillCountry ,tblBillState.appState as appBillState,tblBillCity.appCity as appBillCity  ";
         
            StrQuery += " From (Select appCourierCompanyID,appDocketNo,min(appOrderId) as appOrderId From tblSubOrder where appCourierCompanyID is not null Group by appCourierCompanyID,appDocketNo )tblSubOrder";
            StrQuery += " Inner join tblOrder on tblOrder.appOrderID=tblSubOrder.appOrderID ";
            StrQuery += " Inner join tblCourierCompany on tblCourierCompany.appCourierCompanyID=tblSubOrder.appCourierCompanyID ";
            StrQuery += " Inner join tblCountry on tblCountry.appCountryID=tblOrder.appReceiverCountryID ";
            StrQuery += " Inner join tblState on tblState.appStateID=tblOrder.appReceiverStateID ";
            StrQuery += " Inner join tblCity on tblCity.appCityid=tblOrder.appReceiverCityID  ";
            StrQuery += " Inner join tblCountry as tblBillCountry  on tblBillCountry.appCountryID=tblOrder.appBillReceiverCountryID ";
            StrQuery += " Inner join tblState as tblBillState on tblBillState.appStateID=tblOrder.appBillReceiverStateID ";
            StrQuery += " Inner join tblCity as tblBillCity on tblBillCity.appCityid=tblOrder.appBillReceiverCityID Where 1=1 ";

            if (strOrderId != "")
            {
                StrQuery += " and tblSubOrder.apporderId  in (" + strOrderId + ") ";
            }
            if (strStatus != "")
            {
                StrQuery += " and tblOrder.appOrderStatusID =" + strStatus;
            }
     
            base.LoadFromRawSql(StrQuery);
            return base.DefaultView.Table;
        }

        public DataTable GetWeightandQty(string strOrderId, string strStatus)
        {
            String StrQuery = " Select isnull(sum(tblProduct.appWeight),1) appWeight,sum(tblSubOrder.appQty)appQty  from  tblOrder   inner join  tblSubOrder on tblSubOrder.appOrderId=tblOrder.appOrderId   Inner join tblProductDetail on tblProductDetail.appProductDetailID=tblSubOrder.appProductDetailID     Inner join tblProductColor On tblProductColor.appProductColorID=tblProductDetail.appProductColorID    Inner join tblProduct on tblProduct.appProductID=tblProductColor.appProductID   ";
            StrQuery += " where tblsubOrder.appSubOrderStatusID=" + strStatus + " And tblOrder.appOrderID="+strOrderId ;
            base.LoadFromRawSql(StrQuery);
            return base.DefaultView.Table;
        }
    }
}
